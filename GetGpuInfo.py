# encoding utf-8
import os
import xmltodict
from collections import OrderedDict
from xml.parsers.expat import ExpatError
'''
读取linux中的gpu配置文件转化为json
stdout = os.popen("nvidia-smi -q -x")
content = stdout.read()
convertJson = xmltodict.parse(content, encoding='utf-8')

'''
x = ([('timestamp', 'Wed Jul 24 12:14:13 2019'), ('driver_version', '418.67'), ('cuda_version', '10.1'), ('attached_gpus', '6'), ('gpu', [OrderedDict([('@id', '00000000:02:00.0'), ('product_name', 'P104-100'), ('product_brand', 'GeForce'), ('display_mode', 'Disabled'), ('display_active', 'Disabled'), ('persistence_mode', 'Disabled'), ('accounting_mode', 'Disabled'), ('accounting_mode_buffer_size', '4000'), ('driver_model', OrderedDict([('current_dm', 'N/A'), ('pending_dm', 'N/A')])), ('serial', 'N/A'), ('uuid', 'GPU-7543c5d2-6fad-c796-50da-35ea6e98410b'), ('minor_number', '0'), ('vbios_version', '86.04.7A.00.30'), ('multigpu_board', 'No'), ('board_id', '0x200'), ('gpu_part_number', 'N/A'), ('inforom_version', OrderedDict([('img_version', 'G001.0000.01.04'), ('oem_object', '1.1'), ('ecc_object', 'N/A'), ('pwr_object', 'N/A')])), ('gpu_operation_mode', OrderedDict([('current_gom', 'N/A'), ('pending_gom', 'N/A')])), ('gpu_virtualization_mode', OrderedDict([('virtualization_mode', 'None')])), ('ibmnpu', OrderedDict([('relaxed_ordering_mode', 'N/A')])), ('pci', OrderedDict([('pci_bus', '02'), ('pci_device', '00'), ('pci_domain', '0000'), ('pci_device_id', '1B8710DE'), ('pci_bus_id', '00000000:02:00.0'), ('pci_sub_system_id', '376F1458'), ('pci_gpu_link_info', OrderedDict([('pcie_gen', OrderedDict([('max_link_gen', '1'), ('current_link_gen', '1')])), ('link_widths', OrderedDict([('max_link_width', '4x'), ('current_link_width', '1x')]))])), ('pci_bridge_chip', OrderedDict([('bridge_chip_type', 'N/A'), ('bridge_chip_fw', 'N/A')])), ('replay_counter', '0'), ('replay_rollover_counter', '0'), ('tx_util', '0 KB/s'), ('rx_util', '0 KB/s')])), ('fan_speed', '25 %'), ('performance_state', 'P8'), ('clocks_throttle_reasons', OrderedDict([('clocks_throttle_reason_gpu_idle', 'Active'), ('clocks_throttle_reason_applications_clocks_setting', 'Not Active'), ('clocks_throttle_reason_sw_power_cap', 'Not Active'), ('clocks_throttle_reason_hw_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_power_brake_slowdown', 'Not Active'), ('clocks_throttle_reason_sync_boost', 'Not Active'), ('clocks_throttle_reason_sw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_display_clocks_setting', 'Not Active')])), ('fb_memory_usage', OrderedDict([('total', '4042 MiB'), ('used', '252 MiB'), ('free', '3790 MiB')])), ('bar1_memory_usage', OrderedDict([('total', '256 MiB'), ('used', '2 MiB'), ('free', '254 MiB')])), ('compute_mode', 'Default'), ('utilization', OrderedDict([('gpu_util', '3 %'), ('memory_util', '1 %'), ('encoder_util', 'N/A'), ('decoder_util', 'N/A')])), ('encoder_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('fbc_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('ecc_mode', OrderedDict([('current_ecc', 'N/A'), ('pending_ecc', 'N/A')])), ('ecc_errors', OrderedDict([('volatile', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))])), ('aggregate', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))]))])), ('retired_pages', OrderedDict([('multiple_single_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('double_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('pending_retirement', 'N/A')])), ('temperature', OrderedDict([('gpu_temp', '33 C'), ('gpu_temp_max_threshold', '96 C'), ('gpu_temp_slow_threshold', '93 C'), ('gpu_temp_max_gpu_threshold', 'N/A'), ('memory_temp', 'N/A'), ('gpu_temp_max_mem_threshold', 'N/A')])), ('power_readings', OrderedDict([('power_state', 'P8'), ('power_management', 'Supported'), ('power_draw', '7.57 W'), ('power_limit', '180.00 W'), ('default_power_limit', '180.00 W'), ('enforced_power_limit', '180.00 W'), ('min_power_limit', '90.00 W'), ('max_power_limit', '217.00 W')])), ('clocks', OrderedDict([('graphics_clock', '139 MHz'), ('sm_clock', '139 MHz'), ('mem_clock', '405 MHz'), ('video_clock', '544 MHz')])), ('applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('default_applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('max_clocks', OrderedDict([('graphics_clock', '1911 MHz'), ('sm_clock', '1911 MHz'), ('mem_clock', '5005 MHz'), ('video_clock', '1708 MHz')])), ('max_customer_boost_clocks', OrderedDict([('graphics_clock', 'N/A')])), ('clock_policy', OrderedDict([('auto_boost', 'N/A'), ('auto_boost_default', 'N/A')])), ('supported_clocks', 'N/A'), ('processes', OrderedDict([('process_info', [OrderedDict([('pid', '973'), ('type', 'G'), ('process_name', '/usr/lib/xorg/Xorg'), ('used_memory', '159 MiB')]), OrderedDict([('pid', '1665'), ('type', 'G'), ('process_name', 'compiz'), ('used_memory', '92 MiB')])])])), ('accounted_processes', None)]), OrderedDict([('@id', '00000000:03:00.0'), ('product_name', 'P104-100'), ('product_brand', 'GeForce'), ('display_mode', 'Disabled'), ('display_active', 'Disabled'), ('persistence_mode', 'Disabled'), ('accounting_mode', 'Disabled'), ('accounting_mode_buffer_size', '4000'), ('driver_model', OrderedDict([('current_dm', 'N/A'), ('pending_dm', 'N/A')])), ('serial', 'N/A'), ('uuid', 'GPU-dc32bc86-3255-8118-fec4-61c88e141a54'), ('minor_number', '1'), ('vbios_version', '86.04.7A.00.30'), ('multigpu_board', 'No'), ('board_id', '0x300'), ('gpu_part_number', 'N/A'), ('inforom_version', OrderedDict([('img_version', 'G001.0000.01.04'), ('oem_object', '1.1'), ('ecc_object', 'N/A'), ('pwr_object', 'N/A')])), ('gpu_operation_mode', OrderedDict([('current_gom', 'N/A'), ('pending_gom', 'N/A')])), ('gpu_virtualization_mode', OrderedDict([('virtualization_mode', 'None')])), ('ibmnpu', OrderedDict([('relaxed_ordering_mode', 'N/A')])), ('pci', OrderedDict([('pci_bus', '03'), ('pci_device', '00'), ('pci_domain', '0000'), ('pci_device_id', '1B8710DE'), ('pci_bus_id', '00000000:03:00.0'), ('pci_sub_system_id', '376F1458'), ('pci_gpu_link_info', OrderedDict([('pcie_gen', OrderedDict([('max_link_gen', '1'), ('current_link_gen', '1')])), ('link_widths', OrderedDict([('max_link_width', '4x'), ('current_link_width', '1x')]))])), ('pci_bridge_chip', OrderedDict([('bridge_chip_type', 'N/A'), ('bridge_chip_fw', 'N/A')])), ('replay_counter', '0'), ('replay_rollover_counter', '0'), ('tx_util', '0 KB/s'), ('rx_util', '0 KB/s')])), ('fan_speed', '27 %'), ('performance_state', 'P8'), ('clocks_throttle_reasons', OrderedDict([('clocks_throttle_reason_gpu_idle', 'Active'), ('clocks_throttle_reason_applications_clocks_setting', 'Not Active'), ('clocks_throttle_reason_sw_power_cap', 'Not Active'), ('clocks_throttle_reason_hw_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_power_brake_slowdown', 'Not Active'), ('clocks_throttle_reason_sync_boost', 'Not Active'), ('clocks_throttle_reason_sw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_display_clocks_setting', 'Not Active')])), ('fb_memory_usage', OrderedDict([('total', '4042 MiB'), ('used', '0 MiB'), ('free', '4042 MiB')])), ('bar1_memory_usage', OrderedDict([('total', '256 MiB'), ('used', '2 MiB'), ('free', '254 MiB')])), ('compute_mode', 'Default'), ('utilization', OrderedDict([('gpu_util', '0 %'), ('memory_util', '0 %'), ('encoder_util', 'N/A'), ('decoder_util', 'N/A')])), ('encoder_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('fbc_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('ecc_mode', OrderedDict([('current_ecc', 'N/A'), ('pending_ecc', 'N/A')])), ('ecc_errors', OrderedDict([('volatile', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))])), ('aggregate', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))]))])), ('retired_pages', OrderedDict([('multiple_single_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('double_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('pending_retirement', 'N/A')])), ('temperature', OrderedDict([('gpu_temp', '34 C'), ('gpu_temp_max_threshold', '96 C'), ('gpu_temp_slow_threshold', '93 C'), ('gpu_temp_max_gpu_threshold', 'N/A'), ('memory_temp', 'N/A'), ('gpu_temp_max_mem_threshold', 'N/A')])), ('power_readings', OrderedDict([('power_state', 'P8'), ('power_management', 'Supported'), ('power_draw', '7.33 W'), ('power_limit', '180.00 W'), ('default_power_limit', '180.00 W'), ('enforced_power_limit', '180.00 W'), ('min_power_limit', '90.00 W'), ('max_power_limit', '217.00 W')])), ('clocks', OrderedDict([('graphics_clock', '139 MHz'), ('sm_clock', '139 MHz'), ('mem_clock', '405 MHz'), ('video_clock', '544 MHz')])), ('applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('default_applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('max_clocks', OrderedDict([('graphics_clock', '1911 MHz'), ('sm_clock', '1911 MHz'), ('mem_clock', '5005 MHz'), ('video_clock', '1708 MHz')])), ('max_customer_boost_clocks', OrderedDict([('graphics_clock', 'N/A')])), ('clock_policy', OrderedDict([('auto_boost', 'N/A'), ('auto_boost_default', 'N/A')])), ('supported_clocks', 'N/A'), ('processes', None), ('accounted_processes', None)]), OrderedDict([('@id', '00000000:04:00.0'), ('product_name', 'P104-100'), ('product_brand', 'GeForce'), ('display_mode', 'Disabled'), ('display_active', 'Disabled'), ('persistence_mode', 'Disabled'), ('accounting_mode', 'Disabled'), ('accounting_mode_buffer_size', '4000'), ('driver_model', OrderedDict([('current_dm', 'N/A'), ('pending_dm', 'N/A')])), ('serial', 'N/A'), ('uuid', 'GPU-22ac5d6b-6ba4-550d-5348-0aa3758f0a57'), ('minor_number', '2'), ('vbios_version', '86.04.7A.00.30'), ('multigpu_board', 'No'), ('board_id', '0x400'), ('gpu_part_number', 'N/A'), ('inforom_version', OrderedDict([('img_version', 'G001.0000.01.04'), ('oem_object', '1.1'), ('ecc_object', 'N/A'), ('pwr_object', 'N/A')])), ('gpu_operation_mode', OrderedDict([('current_gom', 'N/A'), ('pending_gom', 'N/A')])), ('gpu_virtualization_mode', OrderedDict([('virtualization_mode', 'None')])), ('ibmnpu', OrderedDict([('relaxed_ordering_mode', 'N/A')])), ('pci', OrderedDict([('pci_bus', '04'), ('pci_device', '00'), ('pci_domain', '0000'), ('pci_device_id', '1B8710DE'), ('pci_bus_id', '00000000:04:00.0'), ('pci_sub_system_id', '376F1458'), ('pci_gpu_link_info', OrderedDict([('pcie_gen', OrderedDict([('max_link_gen', '1'), ('current_link_gen', '1')])), ('link_widths', OrderedDict([('max_link_width', '4x'), ('current_link_width', '1x')]))])), ('pci_bridge_chip', OrderedDict([('bridge_chip_type', 'N/A'), ('bridge_chip_fw', 'N/A')])), ('replay_counter', '0'), ('replay_rollover_counter', '0'), ('tx_util', '0 KB/s'), ('rx_util', '0 KB/s')])), ('fan_speed', '32 %'), ('performance_state', 'P8'), ('clocks_throttle_reasons', OrderedDict([('clocks_throttle_reason_gpu_idle', 'Active'), ('clocks_throttle_reason_applications_clocks_setting', 'Not Active'), ('clocks_throttle_reason_sw_power_cap', 'Not Active'), ('clocks_throttle_reason_hw_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_power_brake_slowdown', 'Not Active'), ('clocks_throttle_reason_sync_boost', 'Not Active'), ('clocks_throttle_reason_sw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_display_clocks_setting', 'Not Active')])), ('fb_memory_usage', OrderedDict([('total', '4042 MiB'), ('used', '0 MiB'), ('free', '4042 MiB')])), ('bar1_memory_usage', OrderedDict([('total', '256 MiB'), ('used', '2 MiB'), ('free', '254 MiB')])), ('compute_mode', 'Default'), ('utilization', OrderedDict([('gpu_util', '0 %'), ('memory_util', '0 %'), ('encoder_util', 'N/A'), ('decoder_util', 'N/A')])), ('encoder_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('fbc_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('ecc_mode', OrderedDict([('current_ecc', 'N/A'), ('pending_ecc', 'N/A')])), ('ecc_errors', OrderedDict([('volatile', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))])), ('aggregate', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))]))])), ('retired_pages', OrderedDict([('multiple_single_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('double_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('pending_retirement', 'N/A')])), ('temperature', OrderedDict([('gpu_temp', '39 C'), ('gpu_temp_max_threshold', '96 C'), ('gpu_temp_slow_threshold', '93 C'), ('gpu_temp_max_gpu_threshold', 'N/A'), ('memory_temp', 'N/A'), ('gpu_temp_max_mem_threshold', 'N/A')])), ('power_readings', OrderedDict([('power_state', 'P8'), ('power_management', 'Supported'), ('power_draw', '7.76 W'), ('power_limit', '180.00 W'), ('default_power_limit', '180.00 W'), ('enforced_power_limit', '180.00 W'), ('min_power_limit', '90.00 W'), ('max_power_limit', '217.00 W')])), ('clocks', OrderedDict([('graphics_clock', '139 MHz'), ('sm_clock', '139 MHz'), ('mem_clock', '405 MHz'), ('video_clock', '544 MHz')])), ('applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('default_applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('max_clocks', OrderedDict([('graphics_clock', '1911 MHz'), ('sm_clock', '1911 MHz'), ('mem_clock', '5005 MHz'), ('video_clock', '1708 MHz')])), ('max_customer_boost_clocks', OrderedDict([('graphics_clock', 'N/A')])), ('clock_policy', OrderedDict([('auto_boost', 'N/A'), ('auto_boost_default', 'N/A')])), ('supported_clocks', 'N/A'), ('processes', None), ('accounted_processes', None)]), OrderedDict([('@id', '00000000:05:00.0'), ('product_name', 'P104-100'), ('product_brand', 'GeForce'), ('display_mode', 'Disabled'), ('display_active', 'Disabled'), ('persistence_mode', 'Disabled'), ('accounting_mode', 'Disabled'), ('accounting_mode_buffer_size', '4000'), ('driver_model', OrderedDict([('current_dm', 'N/A'), ('pending_dm', 'N/A')])), ('serial', 'N/A'), ('uuid', 'GPU-7319f5a3-b1cc-bc29-3874-a388fee308f3'), ('minor_number', '3'), ('vbios_version', '86.04.7A.00.30'), ('multigpu_board', 'No'), ('board_id', '0x500'), ('gpu_part_number', 'N/A'), ('inforom_version', OrderedDict([('img_version', 'G001.0000.01.04'), ('oem_object', '1.1'), ('ecc_object', 'N/A'), ('pwr_object', 'N/A')])), ('gpu_operation_mode', OrderedDict([('current_gom', 'N/A'), ('pending_gom', 'N/A')])), ('gpu_virtualization_mode', OrderedDict([('virtualization_mode', 'None')])), ('ibmnpu', OrderedDict([('relaxed_ordering_mode', 'N/A')])), ('pci', OrderedDict([('pci_bus', '05'), ('pci_device', '00'), ('pci_domain', '0000'), ('pci_device_id', '1B8710DE'), ('pci_bus_id', '00000000:05:00.0'), ('pci_sub_system_id', '376F1458'), ('pci_gpu_link_info', OrderedDict([('pcie_gen', OrderedDict([('max_link_gen', '1'), ('current_link_gen', '1')])), ('link_widths', OrderedDict([('max_link_width', '4x'), ('current_link_width', '1x')]))])), ('pci_bridge_chip', OrderedDict([('bridge_chip_type', 'N/A'), ('bridge_chip_fw', 'N/A')])), ('replay_counter', '0'), ('replay_rollover_counter', '0'), ('tx_util', '0 KB/s'), ('rx_util', '0 KB/s')])), ('fan_speed', '27 %'), ('performance_state', 'P8'), ('clocks_throttle_reasons', OrderedDict([('clocks_throttle_reason_gpu_idle', 'Active'), ('clocks_throttle_reason_applications_clocks_setting', 'Not Active'), ('clocks_throttle_reason_sw_power_cap', 'Not Active'), ('clocks_throttle_reason_hw_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_power_brake_slowdown', 'Not Active'), ('clocks_throttle_reason_sync_boost', 'Not Active'), ('clocks_throttle_reason_sw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_display_clocks_setting', 'Not Active')])), ('fb_memory_usage', OrderedDict([('total', '4042 MiB'), ('used', '0 MiB'), ('free', '4042 MiB')])), ('bar1_memory_usage', OrderedDict([('total', '256 MiB'), ('used', '2 MiB'), ('free', '254 MiB')])), ('compute_mode', 'Default'), ('utilization', OrderedDict([('gpu_util', '0 %'), ('memory_util', '0 %'), ('encoder_util', 'N/A'), ('decoder_util', 'N/A')])), ('encoder_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('fbc_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('ecc_mode', OrderedDict([('current_ecc', 'N/A'), ('pending_ecc', 'N/A')])), ('ecc_errors', OrderedDict([('volatile', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))])), ('aggregate', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))]))])), ('retired_pages', OrderedDict([('multiple_single_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('double_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('pending_retirement', 'N/A')])), ('temperature', OrderedDict([('gpu_temp', '34 C'), ('gpu_temp_max_threshold', '96 C'), ('gpu_temp_slow_threshold', '93 C'), ('gpu_temp_max_gpu_threshold', 'N/A'), ('memory_temp', 'N/A'), ('gpu_temp_max_mem_threshold', 'N/A')])), ('power_readings', OrderedDict([('power_state', 'P8'), ('power_management', 'Supported'), ('power_draw', '7.57 W'), ('power_limit', '180.00 W'), ('default_power_limit', '180.00 W'), ('enforced_power_limit', '180.00 W'), ('min_power_limit', '90.00 W'), ('max_power_limit', '217.00 W')])), ('clocks', OrderedDict([('graphics_clock', '139 MHz'), ('sm_clock', '139 MHz'), ('mem_clock', '405 MHz'), ('video_clock', '544 MHz')])), ('applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('default_applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('max_clocks', OrderedDict([('graphics_clock', '1911 MHz'), ('sm_clock', '1911 MHz'), ('mem_clock', '5005 MHz'), ('video_clock', '1708 MHz')])), ('max_customer_boost_clocks', OrderedDict([('graphics_clock', 'N/A')])), ('clock_policy', OrderedDict([('auto_boost', 'N/A'), ('auto_boost_default', 'N/A')])), ('supported_clocks', 'N/A'), ('processes', None), ('accounted_processes', None)]), OrderedDict([('@id', '00000000:06:00.0'), ('product_name', 'P104-100'), ('product_brand', 'GeForce'), ('display_mode', 'Disabled'), ('display_active', 'Disabled'), ('persistence_mode', 'Disabled'), ('accounting_mode', 'Disabled'), ('accounting_mode_buffer_size', '4000'), ('driver_model', OrderedDict([('current_dm', 'N/A'), ('pending_dm', 'N/A')])), ('serial', 'N/A'), ('uuid', 'GPU-dbc4ebce-d2bc-1e9b-fe9c-1072ff43d0f7'), ('minor_number', '4'), ('vbios_version', '86.04.7A.00.30'), ('multigpu_board', 'No'), ('board_id', '0x600'), ('gpu_part_number', 'N/A'), ('inforom_version', OrderedDict([('img_version', 'G001.0000.01.04'), ('oem_object', '1.1'), ('ecc_object', 'N/A'), ('pwr_object', 'N/A')])), ('gpu_operation_mode', OrderedDict([('current_gom', 'N/A'), ('pending_gom', 'N/A')])), ('gpu_virtualization_mode', OrderedDict([('virtualization_mode', 'None')])), ('ibmnpu', OrderedDict([('relaxed_ordering_mode', 'N/A')])), ('pci', OrderedDict([('pci_bus', '06'), ('pci_device', '00'), ('pci_domain', '0000'), ('pci_device_id', '1B8710DE'), ('pci_bus_id', '00000000:06:00.0'), ('pci_sub_system_id', '376F1458'), ('pci_gpu_link_info', OrderedDict([('pcie_gen', OrderedDict([('max_link_gen', '1'), ('current_link_gen', '1')])), ('link_widths', OrderedDict([('max_link_width', '4x'), ('current_link_width', '1x')]))])), ('pci_bridge_chip', OrderedDict([('bridge_chip_type', 'N/A'), ('bridge_chip_fw', 'N/A')])), ('replay_counter', '0'), ('replay_rollover_counter', '0'), ('tx_util', '0 KB/s'), ('rx_util', '0 KB/s')])), ('fan_speed', '31 %'), ('performance_state', 'P8'), ('clocks_throttle_reasons', OrderedDict([('clocks_throttle_reason_gpu_idle', 'Active'), ('clocks_throttle_reason_applications_clocks_setting', 'Not Active'), ('clocks_throttle_reason_sw_power_cap', 'Not Active'), ('clocks_throttle_reason_hw_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_power_brake_slowdown', 'Not Active'), ('clocks_throttle_reason_sync_boost', 'Not Active'), ('clocks_throttle_reason_sw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_display_clocks_setting', 'Not Active')])), ('fb_memory_usage', OrderedDict([('total', '4042 MiB'), ('used', '0 MiB'), ('free', '4042 MiB')])), ('bar1_memory_usage', OrderedDict([('total', '256 MiB'), ('used', '2 MiB'), ('free', '254 MiB')])), ('compute_mode', 'Default'), ('utilization', OrderedDict([('gpu_util', '0 %'), ('memory_util', '0 %'), ('encoder_util', 'N/A'), ('decoder_util', 'N/A')])), ('encoder_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('fbc_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('ecc_mode', OrderedDict([('current_ecc', 'N/A'), ('pending_ecc', 'N/A')])), ('ecc_errors', OrderedDict([('volatile', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))])), ('aggregate', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))]))])), ('retired_pages', OrderedDict([('multiple_single_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('double_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('pending_retirement', 'N/A')])), ('temperature', OrderedDict([('gpu_temp', '38 C'), ('gpu_temp_max_threshold', '96 C'), ('gpu_temp_slow_threshold', '93 C'), ('gpu_temp_max_gpu_threshold', 'N/A'), ('memory_temp', 'N/A'), ('gpu_temp_max_mem_threshold', 'N/A')])), ('power_readings', OrderedDict([('power_state', 'P8'), ('power_management', 'Supported'), ('power_draw', '7.48 W'), ('power_limit', '180.00 W'), ('default_power_limit', '180.00 W'), ('enforced_power_limit', '180.00 W'), ('min_power_limit', '90.00 W'), ('max_power_limit', '217.00 W')])), ('clocks', OrderedDict([('graphics_clock', '139 MHz'), ('sm_clock', '139 MHz'), ('mem_clock', '405 MHz'), ('video_clock', '544 MHz')])), ('applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('default_applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('max_clocks', OrderedDict([('graphics_clock', '1911 MHz'), ('sm_clock', '1911 MHz'), ('mem_clock', '5005 MHz'), ('video_clock', '1708 MHz')])), ('max_customer_boost_clocks', OrderedDict([('graphics_clock', 'N/A')])), ('clock_policy', OrderedDict([('auto_boost', 'N/A'), ('auto_boost_default', 'N/A')])), ('supported_clocks', 'N/A'), ('processes', None), ('accounted_processes', None)]), OrderedDict([('@id', '00000000:07:00.0'), ('product_name', 'P104-100'), ('product_brand', 'GeForce'), ('display_mode', 'Disabled'), ('display_active', 'Disabled'), ('persistence_mode', 'Disabled'), ('accounting_mode', 'Disabled'), ('accounting_mode_buffer_size', '4000'), ('driver_model', OrderedDict([('current_dm', 'N/A'), ('pending_dm', 'N/A')])), ('serial', 'N/A'), ('uuid', 'GPU-91898f65-2030-3604-ff16-7aad833baf98'), ('minor_number', '5'), ('vbios_version', '86.04.7A.00.30'), ('multigpu_board', 'No'), ('board_id', '0x700'), ('gpu_part_number', 'N/A'), ('inforom_version', OrderedDict([('img_version', 'G001.0000.01.04'), ('oem_object', '1.1'), ('ecc_object', 'N/A'), ('pwr_object', 'N/A')])), ('gpu_operation_mode', OrderedDict([('current_gom', 'N/A'), ('pending_gom', 'N/A')])), ('gpu_virtualization_mode', OrderedDict([('virtualization_mode', 'None')])), ('ibmnpu', OrderedDict([('relaxed_ordering_mode', 'N/A')])), ('pci', OrderedDict([('pci_bus', '07'), ('pci_device', '00'), ('pci_domain', '0000'), ('pci_device_id', '1B8710DE'), ('pci_bus_id', '00000000:07:00.0'), ('pci_sub_system_id', '376F1458'), ('pci_gpu_link_info', OrderedDict([('pcie_gen', OrderedDict([('max_link_gen', '1'), ('current_link_gen', '1')])), ('link_widths', OrderedDict([('max_link_width', '4x'), ('current_link_width', '1x')]))])), ('pci_bridge_chip', OrderedDict([('bridge_chip_type', 'N/A'), ('bridge_chip_fw', 'N/A')])), ('replay_counter', '0'), ('replay_rollover_counter', '0'), ('tx_util', '0 KB/s'), ('rx_util', '0 KB/s')])), ('fan_speed', '27 %'), ('performance_state', 'P8'), ('clocks_throttle_reasons', OrderedDict([('clocks_throttle_reason_gpu_idle', 'Active'), ('clocks_throttle_reason_applications_clocks_setting', 'Not Active'), ('clocks_throttle_reason_sw_power_cap', 'Not Active'), ('clocks_throttle_reason_hw_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_hw_power_brake_slowdown', 'Not Active'), ('clocks_throttle_reason_sync_boost', 'Not Active'), ('clocks_throttle_reason_sw_thermal_slowdown', 'Not Active'), ('clocks_throttle_reason_display_clocks_setting', 'Not Active')])), ('fb_memory_usage', OrderedDict([('total', '4042 MiB'), ('used', '0 MiB'), ('free', '4042 MiB')])), ('bar1_memory_usage', OrderedDict([('total', '256 MiB'), ('used', '2 MiB'), ('free', '254 MiB')])), ('compute_mode', 'Default'), ('utilization', OrderedDict([('gpu_util', '0 %'), ('memory_util', '0 %'), ('encoder_util', 'N/A'), ('decoder_util', 'N/A')])), ('encoder_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('fbc_stats', OrderedDict([('session_count', '0'), ('average_fps', '0'), ('average_latency', '0')])), ('ecc_mode', OrderedDict([('current_ecc', 'N/A'), ('pending_ecc', 'N/A')])), ('ecc_errors', OrderedDict([('volatile', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))])), ('aggregate', OrderedDict([('single_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')])), ('double_bit', OrderedDict([('device_memory', 'N/A'), ('register_file', 'N/A'), ('l1_cache', 'N/A'), ('l2_cache', 'N/A'), ('texture_memory', 'N/A'), ('texture_shm', 'N/A'), ('cbu', 'N/A'), ('total', 'N/A')]))]))])), ('retired_pages', OrderedDict([('multiple_single_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('double_bit_retirement', OrderedDict([('retired_count', 'N/A'), ('retired_pagelist', 'N/A')])), ('pending_retirement', 'N/A')])), ('temperature', OrderedDict([('gpu_temp', '35 C'), ('gpu_temp_max_threshold', '96 C'), ('gpu_temp_slow_threshold', '93 C'), ('gpu_temp_max_gpu_threshold', 'N/A'), ('memory_temp', 'N/A'), ('gpu_temp_max_mem_threshold', 'N/A')])), ('power_readings', OrderedDict([('power_state', 'P8'), ('power_management', 'Supported'), ('power_draw', '7.47 W'), ('power_limit', '180.00 W'), ('default_power_limit', '180.00 W'), ('enforced_power_limit', '180.00 W'), ('min_power_limit', '90.00 W'), ('max_power_limit', '217.00 W')])), ('clocks', OrderedDict([('graphics_clock', '139 MHz'), ('sm_clock', '139 MHz'), ('mem_clock', '405 MHz'), ('video_clock', '544 MHz')])), ('applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('default_applications_clocks', OrderedDict([('graphics_clock', 'N/A'), ('mem_clock', 'N/A')])), ('max_clocks', OrderedDict([('graphics_clock', '1911 MHz'), ('sm_clock', '1911 MHz'), ('mem_clock', '5005 MHz'), ('video_clock', '1708 MHz')])), ('max_customer_boost_clocks', OrderedDict([('graphics_clock', 'N/A')])), ('clock_policy', OrderedDict([('auto_boost', 'N/A'), ('auto_boost_default', 'N/A')])), ('supported_clocks', 'N/A'), ('processes', None), ('accounted_processes', None)])])])


class XMLFormatError(BaseException):
    def __str__(self):
        return "xml format error"


def get_gpu_info():
    """

    :return:
    """

    stdout = os.popen("nvidia-smi -q -x")
    xml_content = stdout.read()
    assert type(xml_content) == str
    try:
        nvidia_ordered_dict = xmltodict.parse(xml_content, encoding='utf-8')
    except ExpatError:
        raise XMLFormatError()

    prop_list = [
        'product_name', 'product_brand', 'accounting_mode_buffer_size', 'uuid',
        'fb_memory_usage', 'temperature', 'fan_speed', 'power_readings','minor_number','max_clocks','clocks'
    ]
    gpu_list = []

    try:
        for k, v in nvidia_ordered_dict.items():
            assert type(v) == OrderedDict

            for _, b in v.items():
                # NumberGpu = len(b)
                if type(b) == list:
                    for c in b:
                        # print(c)
                        if type(c) == OrderedDict:
                            for d, e in c.items():
                                if d in prop_list:
                                    # 构建一个存放显卡信息的字典
                                    f = {d: e}

                                    # 将这个字典append到list去
                                    gpu_list.append(f)
        return gpu_list
    except Exception as e:
        print('Error:get gpu info fail')


if __name__ =="__main__":

    x = get_gpu_info()
    print(x)
